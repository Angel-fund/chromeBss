function is_chinese(word){return/^[\u4e00-\u9fa5]+$/g.test(word)}function is_english(word){return/^[a-z\sA-Z]+$/g.test(word)}function valid_word(word){if(word.length===0||word.length>190){return false}if(is_chinese(word)){return"Chinese"}if(is_english(word)){return"English"}return"Mixed"}var enterprise_opened=false;var enterprise_html='<div id="enterprise-lookup" class="ui-widget-content"><div id="enterprise-title"><span id="enterprise"></span><div id="enterprise-control-container"><span id="bssLogo">商安卫士 · 商战雷达</span><a herf="#" id="enterprise-add" style="display: none" class="wegEnterprise-button _switch" title="收藏企业"></a><a herf="#" id="enterprise-remove" class="wegEnterprise-button" title="移除收藏"></a><a href="#" id="enterprise-open" class="wegEnterprise-button" title="查看企业详情" target="_blank"></a><a herf="#" id="enterprise-close" class="wegEnterprise-button" title="关闭查询窗"></a></div><br style="clear: both;" /></div><div id="enterprise-content"></div></div>';$("body").append(enterprise_html);document.addEventListener("DOMNodeInserted",function(event){var element=event.target;if($(element).attr("id")=="readable_iframe"){setTimeout(function(){$("body",element.contentDocument).mouseup(event_mouseup);$("body",element.contentDocument).click(event_click);if($(element).css("z-index")>=2147483647){var style=$(element).attr("style")+" z-index: 2147483646 !important";$(element).attr("style",style)}},1e3)}});$("body").mouseup(event_mouseup);$("body").click(event_click);function event_click(event){if(enterprise_opened){var target=$(event.target);if(target.attr("id")!="enterprise-lookup"&&!target.parents("#enterprise-lookup")[0]){$("#enterprise-lookup").hide();$("#enterprise-remove").hide();$("#enterprise-add").show();enterprise_opened=false}}}var icon_url=chrome.extension.getURL("img/icon.svg");var style_content="<style>#enterprise-pron { background: url("+icon_url+") -94px -34px; }#enterprise-pron:hover { background: url("+icon_url+") -111px -34px; }#enterprise-open { background: url("+icon_url+") -94px -17px; }#enterprise-open:hover { background: url("+icon_url+") -111px -17px; }#enterprise-close { background: url("+icon_url+") -94px 0; }#enterprise-close:hover { background: url("+icon_url+") -111px 0; }#enterprise-add { background: url("+icon_url+") -94px -51px; }#enterprise-add:hover { background: url("+icon_url+") -111px -51px; }#enterprise-remove { background: url("+icon_url+") -94px -68px; }#enterprise-remove:hover { background: url("+icon_url+") -111px -68px; }</style>";if($("head")[0]){$($("head")[0]).append(style_content)}else{$($("body")[0]).prepend(style_content)}$("#enterprise-lookup").draggable({handle:"#enterprise-title"});function get_selection(){var selection=$.trim(window.getSelection());if(!selection){$("iframe").each(function(){if(this.contentDocument){selection=$.trim(this.contentDocument.getSelection())}if(selection){return false}})}return selection}$("#enterprise-add").click(function(){$("#enterprise-add").hide();$("#enterprise-remove").show();var selection=$("#enterprise").text(),Eid=$("#enterprise").attr("data-eid");chrome.extension.sendMessage({method:"add",word:selection,id:Eid})});$("#enterprise-remove").click(function(){$("#enterprise-remove").hide();$("#enterprise-add").show();var selection=$("#enterprise").text();chrome.extension.sendMessage({method:"remove",word:selection})});function event_mouseup(e){chrome.storage.local.set({disable_querybox:false});chrome.storage.local.get("disable_querybox",function(ret){if(!ret.disable_querybox){if(!e.ctrlKey&&!e.metaKey){return}var selection=get_selection(),lang=valid_word(selection);if(!lang){return}$("#enterprise").html(selection);selection=$("#enterprise").text();var windowWidth=$(window).outerWidth(),enterpriseWidth=$("#enterprise-lookup").outerWidth(),left=Math.min(windowWidth+scrollX-enterpriseWidth,e.pageX);$("#enterprise-lookup").attr("style","left: "+left+"px;"+"top: "+e.pageY+"px;");$("#enterprise-open").attr("href",chrome.extension.getURL("main.html#"+selection));$("#enterprise-close").click(function(){$("#enterprise-lookup").hide();$("#enterprise-remove").hide();$("#enterprise-add").show();enterprise_opened=false;return false});$("#enterprise-remove").hide();db_bool(selection);$("#enterprise-pron").hide();$("#enterprise-content").html("加载中……");$("#enterprise-lookup").show();updata_version("#enterprise-content",function(data){if(data.start!="ture"){search()}});var search=function(){var api=sign({name:encodeURI(selection)},"port_enterprise");$.ajax({url:api,dataType:"json",success:function(data){var str_result=result_json(data,false);$("#enterprise-content").html(str_result);var keyword=data.highlightKeywords;highlightKeywords(keyword,".getDetail");commentSubmint();getDetail(false)},error:function(data){$("#enterprise-content").html("查询失败，请检查网络链接")}});setTimeout(function(){enterprise_opened=true},100)}}})}